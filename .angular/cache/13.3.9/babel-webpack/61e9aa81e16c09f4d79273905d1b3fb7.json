{"ast":null,"code":"// Black 2x1 JPEG, with the following meta information set:\n// - EXIF Orientation: 6 (Rotated 90Â° CCW)\n// Source: https://github.com/blueimp/JavaScript-Load-Image\nconst testAutoOrientationImageURL = 'data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAA' + 'AAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBA' + 'QEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQE' + 'BAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/x' + 'ABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAA' + 'AAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==';\nexport function supportsAutomaticRotation() {\n  return new Promise(resolve => {\n    const img = new Image();\n\n    img.onload = () => {\n      // Check if browser supports automatic image orientation:\n      const supported = img.width === 1 && img.height === 2;\n      resolve(supported);\n    };\n\n    img.src = testAutoOrientationImageURL;\n  });\n}\nexport function getTransformationsFromExifData(exifRotationOrBase64Image) {\n  if (typeof exifRotationOrBase64Image === 'string') {\n    exifRotationOrBase64Image = getExifRotation(exifRotationOrBase64Image);\n  }\n\n  switch (exifRotationOrBase64Image) {\n    case 2:\n      return {\n        rotate: 0,\n        flip: true\n      };\n\n    case 3:\n      return {\n        rotate: 2,\n        flip: false\n      };\n\n    case 4:\n      return {\n        rotate: 2,\n        flip: true\n      };\n\n    case 5:\n      return {\n        rotate: 1,\n        flip: true\n      };\n\n    case 6:\n      return {\n        rotate: 1,\n        flip: false\n      };\n\n    case 7:\n      return {\n        rotate: 3,\n        flip: true\n      };\n\n    case 8:\n      return {\n        rotate: 3,\n        flip: false\n      };\n\n    default:\n      return {\n        rotate: 0,\n        flip: false\n      };\n  }\n}\n\nfunction getExifRotation(imageBase64) {\n  const view = new DataView(base64ToArrayBuffer(imageBase64));\n\n  if (view.getUint16(0, false) !== 0xFFD8) {\n    return -2;\n  }\n\n  const length = view.byteLength;\n  let offset = 2;\n\n  while (offset < length) {\n    if (view.getUint16(offset + 2, false) <= 8) return -1;\n    const marker = view.getUint16(offset, false);\n    offset += 2;\n\n    if (marker == 0xFFE1) {\n      if (view.getUint32(offset += 2, false) !== 0x45786966) {\n        return -1;\n      }\n\n      const little = view.getUint16(offset += 6, false) == 0x4949;\n      offset += view.getUint32(offset + 4, little);\n      const tags = view.getUint16(offset, little);\n      offset += 2;\n\n      for (let i = 0; i < tags; i++) {\n        if (view.getUint16(offset + i * 12, little) == 0x0112) {\n          return view.getUint16(offset + i * 12 + 8, little);\n        }\n      }\n    } else if ((marker & 0xFF00) !== 0xFF00) {\n      break;\n    } else {\n      offset += view.getUint16(offset, false);\n    }\n  }\n\n  return -1;\n}\n\nfunction base64ToArrayBuffer(imageBase64) {\n  imageBase64 = imageBase64.replace(/^data\\:([^\\;]+)\\;base64,/gmi, '');\n  const binaryString = atob(imageBase64);\n  const len = binaryString.length;\n  const bytes = new Uint8Array(len);\n\n  for (let i = 0; i < len; i++) {\n    bytes[i] = binaryString.charCodeAt(i);\n  }\n\n  return bytes.buffer;\n}","map":null,"metadata":{},"sourceType":"module"}